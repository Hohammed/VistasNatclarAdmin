<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Buscar Salida</title>
    <link rel="import" href="/Views/Shared/Layout.html" id="import">
</head>
<body class="hold-transition skin-yellow fixed sidebar-mini">
    <div class="wrapper">
        <script>
            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-header');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.sidebar-toggle');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-footer');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.control-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

        </script>
        <div class="content-wrapper">
            <section class="content-header">
                <h1>
                    BUSCAR SALIDA
                </h1>
            </section>

            <section class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header">
                                <h3 class="box-title">
                                    BUSCAR SALIDA
                                </h3>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <!--<div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblUnidadOrganizativa51" style="display:block">Tipo Documento</label>
                                            <select class="form-control" id="cboUnidadOrganizativa51" name="cboUnidadOrganizativa51" style="display:block">
                                                <option value="0">--------TODOS--------</option>
                                                <option value="1">GUIA REMISIÓN</option>
                                                <option value="2">NOTA SALIDA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        <div class="form-group">
                                            <label id="lblSerieEntrada53">Serie</label>
                                            <input type="text" class="form-control" id="nvSerieEntrada53" name="nvSerieEntrada53" value="" style="display: block;" />
                                        </div>
                                    </div>-->

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label class="box-title" id="lblResponsableRequerimiento102">Responsable</label>
                                            <div class="input-group">
                                                <span class="input-group-btn">
                                                    <input type="text" id="nvResponsableRequerimiento102" name="nvResponsableRequerimiento102" class="form-control" />
                                                    <button type="button" class="btn btn-danger " id="btnNuevaBusquedaRQ102"><span class="glyphicon glyphicon-remove"></span></button>
                                                    <input type="hidden" id="iIdResponsableRequerimiento102" name="iIdResponsableRequerimiento102" />
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-1"></div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblNumeroEntrada53">Numero</label>
                                            <input type="text" class="form-control" id="nvNumeroSalida51" name="nvNumeroSalida51" value="" style="display: block;" />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblEstadoSalida51" style="display: block">Estado</label>
                                            <select class="form-control cboEstadoSalida" id="cboEstadoSalida51">
                                                <!--<option value="0">----TODOS------</option>
                                                <option value="1">ACTIVO</option>
                                                <option value="2">CESADO</option>-->
                                            </select>
                                        </div>
                                    </div>

                                </div>
                                <div class="row">

                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblSedeOrigen23">Almacen Origen</label>
                                            <select class="form-control ListaSede" id="cboSedeOrigen23"></select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblSedeOrigen23">Almacen Destino</label>
                                            <select class="form-control ListaSede" id="cboSedeOrigen23"></select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label for="lblFechaIniSalida51" style="display:block">Fecha Inicio</label>
                                            <input type="text" class="datepicker form-control mifecha" id="dFechaIniSalida51" name="dFechaIniSalida51" style="display:block" value="" placeholder="dd/mm/yyyy" />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label for="lblFechaFinSalida51" style="display:block">Fecha Fin</label>
                                            <input type="text" class="datepicker form-control mifecha" id="dFechaFinSalida51" name="dFechaFinSalida51" style="display:block" value="" placeholder="dd/mm/yyyy" />
                                        </div>
                                    </div>

                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <button type="button" class="btn btn-success sincabecera" name="btnBuscarSalida51" id="btnBuscarSalida51" style="display:block">
                                                <span class="glyphicon glyphicon-search">
                                                </span>
                                                <b>Buscar</b>
                                            </button>
                                        </div>

                                    </div>
                                </div>
                                <!--Datos Usuario-->
                                <!--<div class="row">
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblUsuario">Responsable</label>
                                            <input type="text" id="nvUsuario" name="nvUsuario" class="form-control UsuarioOrigen" style="display:block" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblSedeOrigen">Sede Origen</label>
                                            <input type="text" id="vcSedeOrigen" name="vcSedeOrigen" class="form-control SedeOrigen" style="display:block" readonly />
                                        </div>
                                    </div>
                                </div>-->
                                <!--Fin Datos Usuario-->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="content">
                <form name="">
                    <div class="box box-primary">
                        <div class="box-header">
                            <table id="CabeceraRequerimiento">
                                <tr>
                                    <td width="100%">
                                        <b>SALIDA</b>
                                    </td>
                                   

                                    
                                 
                                    <td>
                                        <button type="button" class="btn btn-success" id="btnNuevoSalida51" name="btnNuevoSalida51">
                                            <b>Nuevo</b>
                                            <span class="glyphicon glyphicon-file">
                                            </span>
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="box-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="table-responsive" id="">
                                        <table class="tablesorter-blue table table-bordered table-hover" id="TablaRegistrarSalida">
                                            <thead>
                                                <tr class="info">
                                                    <th style="background-color: #99ffcc" width="100px">Acciones</th>
                                                    
                                                    <th style="background-color: #99ffcc">Codigo</th>
                                                    <th hidden>vcIdSalida</th>
                                                    <th style="background-color: #99ffcc">Responsable</th>
                                                    <th hidden>vcLogin</th>
                                                    <th style="background-color: #99ffcc">Fecha</th>
                                                    <th hidden>dtFecha</th>
                                                    <th style="background-color: #99ffcc">TipoDocumento</th>
                                                    <th hidden>iIdTipoDocumento</th>
                                                    <th style="background-color: #99ffcc">Almacen Origen</th>
                                                    <th hidden>vcIdAlmacen</th>
                                                    <th style="background-color: #99ffcc">Almacen Destino</th>
                                                    <th hidden>vcIdAlmacen</th>
                                                    <th style="background-color: #99ffcc">Estado</th>
                                                    <th hidden>iIdEstado</th>
                    
                                                </tr>
                                            </thead>


                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                </section>
        </div>
    </div>
    




</body>
</html>
<script type="text/javascript">
    $(document).ready(function () {
       
        TipoEstadoSalida();
    });





    $("#nvResponsableRequerimiento102").autocomplete({
        source: function (request, response) {
            filtro = $("#nvResponsableRequerimiento102").val();
            var data = { filtro: filtro };
            $.ajax({
                type: "GET",
                datatype: "json",
                data: { filtro: filtro },
                url: 'http://admin_erp.natclar.com.pe:12000/rWSTrabajador/TrabajadorByFiltro/Get',
                async: true,
                //data: JSON.stringify({usuario: dataobj}),
                //data: JSON.stringify(dataobj),
                //data: jQuery.parseJSON({user:us, pass:passw}),
                //datos: { filtro: filtro },
                contentType: "application/json",
                success: function (data) {
                    //console.log(data)
                    response($.map(data, function (item) {
                        return { value: item.persona.vcApellidoPaterno + " " + item.persona.vcApellidoMaterno + " " + item.persona.vcNombres, text1: item.persona.vcNumeroDocumento };
                    }))
                },
                error: function () { console.log("ERROR..."); }
            })
        },
        minLength: 3,
        select: function (event, ui) {
            $("#nvResponsableRequerimiento102").val(ui.item.text);
            $("#iIdResponsableRequerimiento102").val(ui.item.text1);
            $("#nvResponsableRequerimiento102").prop('readonly', true);
            $("#nvResponsableRequerimiento102").css("background-color", "lightgoldenrodyellow");
        },
        error: function (ex) {
            alert('Error al traer datos.' + ex);
        }
    })
    $(function () {
        $(".datepicker").datepicker();
    });

    $(window).on("load", function () {
        //ObtenerMotivoTareo();
        setTimeout(function () { TablaRegistrarSalida() }, 5000);
    });

    function TablaRegistrarSalida() {
        $("#TablaRegistrarSalida").tablesorter();
    }


    var id_salida;
    var fechainicio;
    var id_almacen;
    var id_login;

    function ObtenerSalidas() {

        id_salida = $("#nvNumeroSalida51").val();
        fechainicio = $("#dFechaIniSalida51").val();
        fechafin = $("#dFechaFinSalida51").val();
        id_almacen = $("#cboSedeOrigen23").val();
        id_login = $("#iIdResponsableRequerimiento102").val()
        iIdEstado = $(".cboEstadoSalida").val()

        var xhr = new XMLHttpRequest();

        var obj;

        xhr.open('GET', 'http://localhost:28959/SalidaByFiltro/Get?' + 'id_salida=' + (id_salida) + '&fechainicio=' + (fechainicio) + '&fechafin=' + (fechafin) + ' &id_almacen=' + (id_almacen) + '&id_login=' + (id_login) + '&iIdEstado=' + (iIdEstado), true);

        xhr.responseType = "json";
        // xhr.setRequestHeader("Content-Type", "application/json");
        //console.log(sede)
        xhr.onload = function () {

            var status = xhr.status;
            if (status == 200) {
                // console.log(xhr.response.GetDataPOSTResult.cUser + " " + xhr.response.GetDataPOSTResult.cPassword);
                obj = xhr.response;
                obj2 = JSON.stringify(obj);
                console.log('arnold' + xhr.response)

                if (obj != 0) {
                    //Para actualizar la fila de las columnas 
                    $("#TablaRegistrarSalida tbody tr").remove();
                    for (i = 0, j = 1; i < obj.length; i++, j++) {
                        $("#TablaRegistrarSalida tbody").append("<tr><td><button type='button' class='btn btn-success btn-xs' id='btnBuscarSalida'><span class='glyphicon glyphicon-info-sign'></span><b>Detalle</b></button></td>" +
                        //'<td>' + j + '</td>' +
                        '<td>' + obj[i].vcIdSalida + '</td>' +
                         '<td>'+ obj[i].vcLogin + '</td>' +
                         '<td>' + obj[i].dtFecha + '</td>' +
                         '<td>' + obj[i].nvTipoDocumento + '</td>' +
                        '<td>' + obj[i].vcIdAlmacen + '</td>' +
                         '<td>' + obj[i].vcIdAlmacen + '</td>' +
                         '<td>' + obj[i].nvEstado + '</td>' +

                        '</td></tr>');

                        console.log("obj[i].vcIdSalida");
                    }
                }
                else {
                    swal("Usted no cuenta con Salidas asignados!")
                }
            }
            else {
                swal("Ocurrió un error al obtener a sus Salidas!")
            }
        }
        xhr.send();
        //xhr.send(dataobj);
    }
    //reordenarSalida();

    $(document).on("click", "#btnBuscarSalida51", function () {
        ObtenerSalidas();
    });

    $(document).on("click", "#btnBuscarSalida", function () {
        //ObtenerCamposRequerimientos();
        id_salida = $(this).parent().parent().find('td:eq(1)').text();
        window.location = './RegistrarSalida?id_salida=' + (id_salida) + '&fechainicio=' + (fechainicio) + '&fechafin=' + (fechafin) + '&id_almacen=' + (id_almacen) + '&id_login=' + (id_login);
    });
    

</script>


