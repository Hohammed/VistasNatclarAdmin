<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Buscar Orden Compra</title>
    <link rel="import" href="/Views/Shared/Layout.html" id="import">
</head>
<body class="hold-transition skin-yellow fixed sidebar-mini" onload="">

    <div class="wrapper">
        <script>
            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-header');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.sidebar-toggle');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-footer');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.control-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

        </script>
        <div class="content-wrapper">
            <section class="content-header">
                <h1>
                    BUSCAR ORDENES DE COMPRA
                </h1>
            </section>


            <section class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header">
                                

                                <div class="row">


                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblSedeOrigen">Almacen Origen</label>
                                            <input type="text" id="vcSedeOrigen" name="vcSedeOrigen" class="form-control SedeOrigen" style="background-color:lightgoldenrodyellow; display:block" readonly />
                                        </div>
                                    </div>


                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblTrabajador1" style="display:block">Responsable</label>
                                            <input type="text" class="form-control" id="nvTrabajador1" name="nvTrabajador1" style="background-color:lightgoldenrodyellow; display:block" readonly />
                                        </div>
                                    </div>

                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblTrabajador1" style="display:block">Numero</label>
                                            <input type="text" class="form-control" id="vcNumero103" name="vcNumero103"  display:block"  />
                                        </div>
                                    </div>

                                   

                                    <!--<div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblDocumentoOrdenCompra103">Documento</label>
                                            <select class="form-control" id="cboDocumentoOrdenCompra103">
                                                <option value="1">----TODOS-----</option>
                                                <option value="2">GUIA REMISIÓN</option>
                                                <option value="3">NOTA ENTRADA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label for="lblNumeroCotizacion103" style="display:block">Numero</label>
                                            <input type="number" id="vcNumeroCotizacion103" name="vcNumeroCotizacion103" class="form-control" style="display:block" />
                                        </div>
                                    </div>-->

                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lbldFechaOrdenCompra103">Fecha Inicio</label>
                                            <input type="text" id="dFechaIniOrdenCompra103" name="dFechaIniOrdenCompra103" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" />
                                        </div>
                                    </div>


                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lbldFechaFinOrdenCompra103">Fecha Fin</label>
                                            <input type="text" id="dFechaFinOrdenCompra103" name="dFechaFinOrdenCompra103" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" />
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                               



                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblSedeOrigen23">Almacen</label>
                                            <select class="form-control ListaSede" id="cboSedeOrigen23"></select>
                                        </div>
                                    </div>

                                    <!--<div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblProveedorOrdenCompra103">Proveedor</label>
                                            <input type="text" class="form-control" id="vcProveedorOrdenCompra103" name="vcProveedorOrdenCompra103" value="" />
                                        </div>
                                    </div>-->


                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblProveedorOrdenCompra103">Proveedor</label>
                                            <input type="text" class="form-control" id="vcProveedorOrdenCompra103" name="vcProveedorOrdenCompra103" value="" />
                                            <input type="hidden" class="form-control" id="vcProveedorRuc103" name="vcProveedorRuc103" value="" />
                                        </div>
                                    </div>



                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblEstablecimientoCotizacion103" style="display: block">Estado</label>
                                            <select class="form-control" style="display: block;" id="cboEstablecimientoCotizacion103">
                                                <option value="0">---TODOS---</option>
                                                <option value="1">BORRADOR</option>
                                                <option value="2">CONFIRMADO</option>
                                            </select>
                                        </div>
                                    </div>


                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblAprobadoOrdenCompra103" style="display: block">Aprobado</label>
                                            <select class="form-control" style="display: block;" id="cboAprobadoOrdenCompra103">
                                                <option value="0">PENDIENTE</option>
                                                <option value="1">APROBADO</option>
                                                <option value="2">RECHAZADO</option>
                                            </select>
                                        </div>
                                    </div>


                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <button type="button" class="btn btn-success sincabecera" style="display: block;" name=" buscar" id="btnBuscarTareo">
                                                <span class="glyphicon glyphicon-search">
                                                </span>
                                                <b>Buscar</b>
                                            </button>
                                        </div>
                                    </div>

                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header">
                                <table id="CabeceraBuscarRequerimiento103">
                                    <tr>
                                        <td width="100%">
                                            <b>LISTA ORDEN COMPRA</b>
                                        </td>
                                        <td width="100%" align="right">
                                            <button type="button" class="btn btn-success" id="NuevoOrdenCompra" name="NuevoOrdenCompra">
                                                <b>Nuevo</b>
                                                <span class="glyphicon glyphicon-file">
                                                </span>
                                            </button>
                                        </td>
                                    </tr>
                                </table>
                 
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover" id="TablaBuscarTareo">
                                    <tr class="info">
                                        <th>Acciones</th>
                                        <th>ID</th>
                                        <th>Almacen</th>
                                        <th>Fecha</th>
                                        <th>Proveedor</th>
                                        <th>Confirmado</th>
                                        <th>Aprobado</th>
                                        <th>Prioridad</th>
                                        <th>Recibido</th>
                                    

                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="BuscarTareo">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td> </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>

                                    </tr>
                                    <tr>
                                        <td>
                                            <button type="button" class="btn btn-info " id="Buscar" name="Buscar">
                                                <span class="glyphicon glyphicon-info-sign">
                                                </span>
                                                <b>Detalle</b>
                                            </button>
                                          
                                        </td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>


                                    </tr>
                                </table>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </section>
        </div>
    </div>
</body>
</html>



<script type="text/javascript">
    $(document).ready(function () {
        $('#TablaRegistrarTareo').DataTable({
            "scrollX": true
        });

        ObtenerTrabajadoresPorSede();

    });

    $(window).on("load", function () {
        ObtenerMotivoTareo();
        retornarFecha();
    });

    $(document).on('change', '.Tipo', function () {

        //alert($(".Tipo option:selected").val())
        var parent = $(this).parents().get(1);
        var Tipo = $(this).val();
        restarHoras(Tipo, parent);
        //$(".Tipo").attr('disabled', 'disabled');


    });


    function ObtenerTrabajadoresPorSede() {
        sede = sessionStorage.getItem("Sede");
        //console.log(sede)
        var xhr = new XMLHttpRequest();
        var dataobj = { sede: sede };
        var obj;

        xhr.open('GET', 'http://admin_erp.natclar.com.pe:12000//api/Trabajadores?sede=' + sede, true);
        xhr.responseType = "json";
        // xhr.setRequestHeader("Content-Type", "application/json");
        //console.log(sede)
        xhr.onload = function () {
            var status = xhr.status;
            if (status == 200) {
                //console.log(xhr.response);
                // console.log(xhr.response.GetDataPOSTResult.cUser + " " + xhr.response.GetDataPOSTResult.cPassword);
                obj = xhr.response;
                if (obj != "0") {
                    for (i = 0, j = 1; i < obj.length; i++, j++) {
                        // console.log(obj[i])
                        $("#TablaRegistrarAsistencia").append('<tr><td>' + j + '</td>' +
                        '<td>' + obj[i].persona.numeroDocumento +
                        '<td>' + obj[i].persona.apellidoPaterno +
                        '<td>' + obj[i].persona.apellidoMaterno +
                        '<td>' + obj[i].persona.nombres +
                        '<td hidden>' + obj[i].puesto.IdPuesto +
                        '<td>' + obj[i].puesto.Descripcion +
                        '<td hidden>' + obj[i].sistemaTrabajo.IdSistemaTrabajo +
                        '<td>' + obj[i].sistemaTrabajo.Descripcion +
                        '<td hidden>' + obj[i].area.IdArea +
                        '<td>' + obj[i].area.Descripcion +
                        '<td hidden>' + obj[i].sede.IdTipoSede +
                        '<td>' + obj[i].sede.descUnidOgani +
                        '<td hidden>' + obj[i].sede.idSede +
                        '<td>' + obj[i].sede.descripcion +
                        '<td hidden>' + "1" +
                        '<td>' + "NATCLAR" +
                        "<td><input type='text' name='ingreso' value='8:00' style='border-width:0' id='ingreso' readonly />" +
                        "<td><input type='text' name='fecha' style='border-width:0' class='fecha' id='fecha' readonly /> " +
                        "<td><input type='text' name='ingresodia' value='' style='border-width:0' id='ingresodia' readonly />" +
                        "<td><select class='Tipo' name='Tipo'></select>" +
                        "<td><input type='text' name='mintotal' value='0:00' style='border-width:0' id='mintotal' />" +
                        '</td></tr>');
                    }
                }
                else {
                    swal("Usted no cuenta con Trabajadores asignados!")
                }
            }
            else {
                swal("Ocurrió un error al obtener a sus Trabajadores!")
            }



        }
        xhr.send();
        //xhr.send(dataobj);

    }

    function ObtenerMotivoTareo() {
        var xhr = new XMLHttpRequest();
        var dataobj = { sede: sede };
        var obj;

        xhr.open('GET', 'http://admin_erp.natclar.com.pe:12000//api/MotivoTareo', true);
        xhr.responseType = "json";
        // xhr.setRequestHeader("Content-Type", "application/json");
        xhr.onload = function () {
            var status = xhr.status;
            if (status == 200) {
                //console.log(xhr.response);
                // console.log(xhr.response.GetDataPOSTResult.cUser + " " + xhr.response.GetDataPOSTResult.cPassword);
                obj = xhr.response;
                //console.log(obj)
                $.each(obj, function (i, Motivo) {
                    $("select.Tipo").append($('<option value="' + Motivo.IdMotTareo + '">' +
                               Motivo.Descripcion + '</option>'));
                });
            }
            else {
                swal("Ocurrió un error al traer los motivos de tareo!")
            }
        }
        xhr.send();
        //xhr.send(dataobj);
    }


     
    $("#vcProveedorOrdenCompra103").autocomplete({
        source: function (request, response) {
            filtro = $("#vcProveedorOrdenCompra103").val();
            var data = { filtro: filtro };
            $.ajax({
                type: "GET",
                datatype: "json",
                data: { filtro: filtro },
                url: 'http://localhost:22822/ProveedorByFiltro/Get',
                async: true,
                contentType: "application/json",
                success: function (data) {
                    response($.map(data, function (item) {
                        return { value: item.nvRazonSocial, text1: item.vcRUCProveedor};
                    }))
                },
                error: function () { console.log("ERROR..."); }
            })
        },
        minLength: 3,
        select: function (event, ui) {
            $("#vcProveedorOrdenCompra103").val(ui.item.text);
            $("#vcProveedorRuc103").val(ui.item.text1);
            //$("#nvTrabajadorR35").prop('readonly', true);
            $("#vcProveedorOrdenCompra103").css("background-color", "lightgoldenrodyellow");
        },
        error: function (ex) {
            alert('Error al traer datos.' + ex);
        }
    })





    function retornarFecha() {
        var fecha;
        fecha = new Date();
        var cadena = fecha.getDate() + '/' + (fecha.getMonth() + 1) + '/' + fecha.getFullYear();
        $(".fecha").val(cadena);
    }

    $(function () {
        $(".datepicker").datepicker();
    });
</script>


