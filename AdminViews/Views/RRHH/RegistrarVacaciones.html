<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Registrar Movimiento</title>
    <link rel="import" href="/Views/Shared/Layout.html" id="import">
</head>
<body class="hold-transition skin-edit fixed sidebar-mini">
    <div class="wrapper">
        <script>
            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-header');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.sidebar-toggle');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-footer');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.control-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

        </script>
        <div class="content-wrapper">
            <section class="content-header">
                <h1>
                    SOLICITAR VACACIONES
                </h1>
            </section>

            <section class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary collapsed-box">
                            <div class="box-header">
                                <h3 class="box-title">DATOS SOLICITANTE</h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                        <i class="fa fa-angle-double-down"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="lblTrabajador113">Solicitante</label>
                                            <input type="text" class="form-control" id="nvTrabajador113" name="nvTrabajador113" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                            <input type="hidden" class="form-control" id="id_Trabajador" name="id_Trabajador" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                        </div>
                                    </div>
                                    <!--<div class="col-md-3">
                                        <div class="form-group">
                                            <label for="lblTrabajadorS35">Solicitante</label>
                                            <div class="input-group">
                                                <span class="input-group-btn">
                                                    <input type="text" class="form-control" id="nvTrabajadorS35" name="nvTrabajadorS35" value="" />
                                                    <button type="button" class="btn btn-danger " id="btnNuevaBusquedaTS35"><span class="glyphicon glyphicon-remove"></span></button>
                                                 </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                    </div>-->
                                    <!--<div class="col-md-3">
                                        <div class="form-group">
                                            <label for="lblTrabajadorAR35">A reemplazar</label>
                                            <div class="input-group">
                                                <span class="input-group-btn">
                                                    <input type="text" class="form-control" id="nvTrabajadorAR35" name="nvTrabajadorAR35" value="" />
                                                    <button type="button" class="btn btn-danger" id="btnNuevaBusquedaTAR35"><span class="glyphicon glyphicon-remove"></span></button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-1">
                                        
                                    </div>-->
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="lblPuesto113">Puesto</label>
                                            <input type="text" class="form-control" id="nvPuesto113" name="nvPuesto113" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                            <input type="hidden" class="form-control" id="id_Puesto" name="id_Puesto" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="lblArea113">Área</label>
                                            <input type="text" class="form-control" id="nvArea113" name="nvArea113" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                            <input type="hidden" class="form-control" id="id_Area" name="id_Area" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lbldFechaVacaciones113">Fecha</label>
                                            <input type="text" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" id="dFechaVacaciones113" name="dFechaVacaciones113" style="display:block; background-color: lightgoldenrodyellow" value="" readonly />
                                            <!-- <input type="text" class="datepicker form-control" placeholder="dd//mm//yyyy" id="dtfechafin" name="dtfechafin" value="" style="width:100px;" />-->
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblUnidadOrganizativa113">Unidad Organizativa</label>
                                            <input type="text" class="form-control" id="nvUnidadOrganizativa113" name="nvUnidadOrganizativa113" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            <input type="hidden" class="form-control" id="id_UnidadOrganizativa" name="id_UnidadOrganizativa" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            <!--<select class="form-control cboUnidadOrganizativa" id="cboUnidadOrganizativa35"></select>-->
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblEmpresa113">Empresa</label>
                                            <input type="text" class="form-control" id="nvEmpresa113" name="nvEmpresa113" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            <input type="hidden" class="form-control" id="id_Empresa" name="id_Empresa" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            <!--<select class="form-control cboEmpresa" id="cboEmpresa35">
                                                <option value="1">Buenaventura</option>
                                                <option value="2">Oyón</option>
                                            </select>-->
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label id="lblSede113">Sede</label>
                                            <input type="text" class="form-control" id="nvSede113" name="nvSede113" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            <input type="hidden" class="form-control" id="id_Sede" name="id_Sede" value="" style="display:block; background-color: lightgoldenrodyellow" readonly />
                                            
                                            <!--<select class="form-control cboSede" id="cboSede35c"></select>-->
                                            <!--ListaSede-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="content-header">
                <!--<h1>
                    DETALLE MOVIMIENTO
                </h1>-->
            </section>

            <section class="content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box box-primary">
                            <div class="box-header">
                                <h3 class="box-title">DETALLE VACACIONES</h3>
                            </div>
                            <div class="box-body">
                              
                                <div class="row">
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lbldFechaIniVacaciones113">Fecha Inicio</label>
                                            <input type="text" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" id="dFechaIniVacaciones113" name="dFechaIniVacaciones113" style="display:block" value="" />
                                            <!-- <input type="text" class="datepicker form-control" placeholder="dd//mm//yyyy" id="dtfechafin" name="dtfechafin" value="" style="width:100px;" />-->
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lbldFechaFinVacaciones113">Fecha Fin</label>
                                            <input type="text" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" id="dFechaFinVacaciones113" name="dFechaFinVacaciones113" style="display:block" value="" />
                                            <!-- <input type="text" class="datepicker form-control" placeholder="dd//mm//yyyy" id="dtfechafin" name="dtfechafin" value="" style="width:100px;" />-->
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblPeriodoIni113">Periodo</label>
                                            <select id="cboPeriodoIni113" class="miperiodo form-control"></select>
                                            <!--<input type="text" class="form-control" id="nvSede35-2" name="nvSede35-2" value="" />-->
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblPeriodoFin113">Periodo</label>
                                            <select id="cboPeriodoFin113" class="miperiodo form-control"></select>
                                            <!--<input type="text" class="form-control" id="nvSede35-2" name="nvSede35-2" value="" />-->
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblDias113">Días a tomar</label>
                                            <input type="number" class="form-control" id="iDias113" name="iDias113" value="" style="background-color:lightgoldenrodyellow" readonly/>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label id="lblFechaRetorno113">Fecha de Retorno</label>
                                            <input type="text" class="datepicker form-control mifecha" placeholder="dd/mm/yyyy" id="dFechaRetorno113" name="dFechaRetorno113" style="display:block;" value=""  />
                                            <!-- <input type="text" class="datepicker form-control" placeholder="dd//mm//yyyy" id="dtfechafin" name="dtfechafin" value="" style="width:100px;" />-->
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label id="lblObservaciones113" style="vertical-align:top;">Observaciones</label>
                                            <textarea rows="3" id="txtaObservaciones113" class="form-control"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        
            <div class="panel-body">
                <div class="form-group">
                    <button type="button" class="btn btn-success" id="btnGuardarVacaciones" name="btnGuardarVacaciones"><span class="glyphicon glyphicon-floppy-disk"></span><b>&nbsp;Guardar</b></button>
                    <!--<button type="button" class="btn btn-success" id=""><span class="glyphicon glyphicon-ok"></span><b>Confirmar</b></button>-->
                    <!--<button type="button" class="btn btn-info" id=""><span class="glyphicon glyphicon-print"></span><b>Imprimir</b></button>-->
                    <button type="button" class="btn btn-danger" id="Cancelar"><span class="glyphicon glyphicon-remove"></span><b>&nbsp; Cancelar</b></button>
                    <button type="button" class="btn btn-warning" id="Atras"><span class="glyphicon glyphicon-arrow-left"></span><b>&nbsp;Atras</b></button>
                </div>
            </div>

        </div>
    </div>
</body>
</html>



<script type="text/javascript">
$(document).ready(function () {
    //$('#TablaRegistrarMovimiento').DataTable({
    //    "scrollX": true 
    //});
    retornarCboAnios();
    ObtenerDatos();
   

    $(document).on("change", "#dFechaFinVacaciones113", function () {
        restaFechas();
        sumaFechas();
    });

    $(function () {
        $(".datepicker").datepicker({
            changeMonth: true,
            changeYear: true
        });
    });

    $(document).on("click", "#Cancelar", function () {
        swal({
            title: "Esta seguro de eliminar este Registro?",
            text: "No podrá recuperar los datos ingresados...!",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Si, estoy seguro!",
            cancelButtonText: "Cancelar!",
            closeOnConfirm: false
        }, function () {
            window.location.href = "../../../Views/RRHH/RegistrarVacaciones.html";
            swal("Correcto!", "Su Registro fue eliminado.", "success");
        });
    });

    //if ($("#documento").val() != 0) {
    //    $("#documento").autocomplete({
    //        source: function (request, response) {
    //            filtro = $("#documento").val();
    //            console.log(filtro)
    //            var data = { filtro: filtro };
    //            $.ajax({
    //                type: "GET",
    //                datatype: "json",
    //                data: { filtro: filtro },
    //                url: 'http://admin_erp.natclar.com.pe:12000//Natclar/TrabajadorByFiltro/Get',
    //                async: true,
    //                //data: JSON.stringify({usuario: dataobj}),
    //                //data: JSON.stringify(dataobj),
    //                //data: jQuery.parseJSON({user:us, pass:passw}),
    //                //datos: { filtro: filtro },
    //                contentType: "application/json",
    //                success: function (data) {
    //                    console.log(data)
    //                    response($.map(data, function (item) {
    //                        return { value: item.persona.vcApellidoPaterno + " " + item.persona.vcApellidoMaterno + " " + item.persona.vcNombres, text1: item.persona.vcNumeroDocumento, text2: item.puesto.Descripcion, text3: item.AreaNatclar.Descripcion, text4: item.sede.UnidadOrganizativa.vcDescripcion, text5: item.UbicacionTrabajo.Unidad.EmpresaTitular.nvRazonSocial, text6: item.sede.Ubigeo.nvDescripcion, text7: item.sistemaTrabajo.vcDescripcion };
    //                    }))
    //                },
    //                error: function () { console.log("ERROR..."); }
    //            })
    //        },
    //        minLength: 3,
    //        select: function (event, ui) {
    //            $("#nvTrabajador113").val(ui.item.text);
    //            $("#nvPuesto113").val(ui.item.text2);
    //            $("#nvArea113").val(ui.item.text3);
    //            $("#nvUnidadOrganizativa113").val(ui.item.text4);
    //            $("#nvEmpresa113").val(ui.item.text5);
    //            $("#nvSede113").val(ui.item.text6);
    //            //$("#nvTrabajadorR35").prop('readonly', true);
    //            //$("#nvTrabajadorR35").css("background-color", "lightgoldenrodyellow");
    //        },
    //        error: function (ex) {
    //            alert('Error al traer datos.' + ex);
    //        }
    //    })
    //}
    
   

});

function restaFechas() {
    f1 = $("#dFechaIniVacaciones113").val();
    f2 = $("#dFechaFinVacaciones113").val();
   
    var aFecha1 = f1.split('/');
    var aFecha2 = f2.split('/');
    var fFecha1 = Date.UTC(aFecha1[2], aFecha1[1] - 1, aFecha1[0]);
    var fFecha2 = Date.UTC(aFecha2[2], aFecha2[1] - 1, aFecha2[0]);
    var dif = fFecha2 - fFecha1;
    var dias = Math.floor(dif / (1000 * 60 * 60 * 24));
    $("#iDias113").val(dias);
}

function sumaFechas() {
    f2 = $("#dFechaIniVacaciones113").val();
    
    dias = $("#iDias113").val();
    dias = Number(dias) + Number(1);
   
    var element = f2.split(' ');
    var fecha = element[0].split('/');
    fecha = fecha[2] + '/' + fecha[1] + '/' + fecha[0];
    //f3 = new Date(fecha);
    f3 = new Date(Date.parse(fecha) + (24 * 60 * 60 * 1000 * dias));
    
    var dia = f3.getDate();
    var mes = f3.getMonth();
    mes++;
    var anio = f3.getFullYear();
    var nueva_fecha = dia + "/" + mes + "/" + anio;
    
    $("#dFechaRetorno113").val(nueva_fecha);

    
}

function ObtenerDatos() {
    filtro = sessionStorage.getItem("dni");
    console.log(filtro)
    $("#documento").val(filtro);
    var xhr = new XMLHttpRequest();
    var dataobj = { filtro: filtro };
    var obj;

    xhr.open('GET', 'http://admin_erp.natclar.com.pe:12000//Natclar/TrabajadorByFiltro/Get?filtro=' + filtro, true);
    xhr.responseType = "json";
    // xhr.setRequestHeader("Content-Type", "application/json");
    xhr.onload = function () {
        var status = xhr.status;
        if (status == 200) {
            //console.log(xhr.response);
            // console.log(xhr.response.GetDataPOSTResult.cUser + " " + xhr.response.GetDataPOSTResult.cPassword);
            obj = xhr.response;
            //console.log(obj)
            $.each(obj, function (i, Datos) {
                console.log(obj)
                a = Datos.persona.vcApellidoMaterno;
                b = Datos.persona.vcApellidoPaterno;
                c = Datos.persona.vcNombres;
                $("#nvTrabajador113").val(c + " " + b + " " + a);
                $("#id_Trabajador").val(Datos.iIdTrabajadorInterno);
                $("#id_Puesto").val(Datos.puesto.IdPuesto);
                $("#nvPuesto113").val(Datos.puesto.Descripcion);
                $("#id_Area").val(Datos.AreaNatclar.IdAreaNatclar);
                $("#nvArea113").val(Datos.AreaNatclar.Descripcion);
                $("#id_UnidadOrganizativa").val(Datos.sede.UnidadOrganizativa.iIdUnidadOrganizativa);
                $("#nvUnidadOrganizativa113").val(Datos.sede.UnidadOrganizativa.vcDescripcion);
                $("#id_Empresa").val(Datos.UbicacionTrabajo.EmpresaContrata.vcRucEmpresa);
                $("#nvEmpresa113").val(Datos.UbicacionTrabajo.EmpresaContrata.nvRazonSocial);
                $("#id_Sede").val(Datos.sede.vcIdSede);
                $("#nvSede113").val(Datos.sede.vcDescripcion);
            });
        }
        else {
            swal("Ocurrió un error al traer los Datos del trabajador!")
        }
    }
    xhr.send();
    //xhr.send(dataobj);
}
</script>
