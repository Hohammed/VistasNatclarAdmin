<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Buscar Requerimiento</title>
    <link rel="import" href="/Views/Shared/Layout.html" id="import">
</head>
<body class="hold-transition skin-edit fixed sidebar-mini">

    <div class="wrapper">
        <script>
            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-header');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.sidebar-toggle');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.main-footer');
            document.body.appendChild(getContent.cloneNode(true));

            var getImport = document.querySelector('#import');
            var getContent = getImport.import.querySelector('.control-sidebar');
            document.body.appendChild(getContent.cloneNode(true));

        </script>
        <div class="content-wrapper">

            <section class="content-header">
                <h1>
                    BUSCAR REQUERIMIENTO
                </h1>
            </section>

            <section class="content">
                <form>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box box-primary ">
                                <div class=" box-header">
                                    <h3 class="box-title">DATOS REQUERIMIENTO</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-angle-double-down"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="box-title" id="lblResponsableRequerimiento137">Responsable</label>
                                                <div class="input-group">
                                                    <span class="input-group-btn">
                                                        <input type="text" id="nvResponsableRequerimiento137" name="nvResponsableRequerimiento137" class="form-control" />
                                                        <button type="button" class="btn btn-danger " id="btnNuevaBusquedaRQ137"><span class="glyphicon glyphicon-remove"></span></button>
                                                        <input type="hidden" id="iIdResponsableRequerimiento137" name="iIdResponsableRequerimiento137" />
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-1">
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label id="lblSedeOrigen23">Sede Origen</label>
                                                <select class="form-control ListaSede" id="cboSedeOrigen137"></select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label id="lblSedeOrigen23">Sede Destino</label>
                                                <select class="form-control ListaSede" id="cboSedeDestino137"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="Fecha">Fecha Inicio</label>
                                                <input type="text" class="datepicker form-control mifecha" name=" dfechainiciorequerimiento137" id="dFechaInicioRequerimiento137" placeholder="dd/mm/yyyy" />
                                            </div>
                                        </div>

                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="Fecha">Fecha Fin</label>
                                                <input type="text" class="datepicker form-control mifecha" name="dFechaFinRequerimiento137" id="dFechaFinRequerimiento137" placeholder="dd/mm/yyyy" />

                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label id="lblEstadoRequerimiento137">Estado</label>
                                                <select class="form-control cboEstadoRequerimiento" id="cboEstadoRequerimiento137">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <button type="button" class="btn btn-success sincabecera" style="display: block;" name="btnBuscarRequerimiento137" id="btnBuscarRequerimiento137">
                                                    <span class="glyphicon glyphicon-search">
                                                    </span>
                                                    <!--<b>Buscar</b>-->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </section>

            <section class="content">
                <form name="">
                    <div class="box box-primary">
                        <div class="box-header">
                            <table id="CabeceraRequerimiento">
                                <tr>
                                    <td width="100%">
                                        <b>LISTA DE REQUERIMIENTOS</b>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-success" id="btnSearch">
                                            <span class="glyphicon glyphicon-search">
                                            </span>
                                        </button>
                                    </td>

                                    <td>
                                        <div id="busqueda" style="display:none">
                                            <input type="text" id="SrcBuscarRQ" name="SrcBuscarRQ" value="" style="border-radius: 3px; height:35px; background-color: lightgoldenrodyellow" />
                                        </div>
                                    </td>

                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>

                                    <td>
                                        <button type="button" class="btn btn-success" id="btnNuevoRequerimiento137" name="btnNuevoRequerimiento137">
                                            <b>Nuevo</b>
                                            <span class="glyphicon glyphicon-file">
                                            </span>
                                        </button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="box-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="table-responsive" id="">
                                        <table class="tablesorter-blue table table-bordered table-hover" id="TablaRegistrarRequerimiento137">
                                            <thead>
                                                <tr class="info">
                                                    <th style="background-color: #99ffcc" width="100px">Acciones</th>
                                                    <th style="background-color: #99ffcc">Item</th>
                                                    <th hidden>IdRequerimiento</th>
                                                    <th style="background-color: #99ffcc">Responsable</th>
                                                    <th style="background-color: #99ffcc">Sede Origen</th>
                                                    <th style="background-color: #99ffcc">Fecha</th>
                                                    <th style="background-color: #99ffcc">Sede Destino</th>
                                                    <th style="background-color: #99ffcc">Estado</th>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

            </section>
        </div>
    </div>

</body>
</html>

<script type="text/javascript">
    $(document).ready(function () {
        //$('#TablaRegistrarRequerimiento137').DataTable({
        //    //"scrollX": true
        //});

        TipoEstadoRRHH();

        $("#btnSearch").click(function () {
            $('#busqueda').toggle("slow");
        });
    });

    $(window).on("load", function () {
        setTimeout(function () { TablaRegistrarRequerimiento() }, 1000);
    });

    function TablaRegistrarRequerimiento() {
        $("#TablaRegistrarRequerimiento137").tablesorter();
    }
       
    $(document).on("click", ".btnVerDetalleRQ", function () {
        var item = $(this).parent().parent().find('td:eq(2)').text();
        localStorage.setItem("iIdRequerimientoRRHH", item)
        window.location.href = './RegistrarRequerimientoRRHH.html';
    });

    $("#nvResponsableRequerimiento137").autocomplete({
        source: function (request, response) {
            filtro = $("#nvResponsableRequerimiento137").val();
            var data = { filtro: filtro };
            $.ajax({
                type: "GET",
                datatype: "json",
                data: { filtro: filtro },
                url: 'http://admin_erp.natclar.com.pe:12000/rWSTrabajador/TrabajadorByFiltro/Get',
                async: true,
                //data: JSON.stringify({usuario: dataobj}),
                //data: JSON.stringify(dataobj),
                //data: jQuery.parseJSON({user:us, pass:passw}),
                //datos: { filtro: filtro },
                contentType: "application/json",
                success: function (data) {
                    //console.log(data)
                    response($.map(data, function (item) {
                        return { value: item.persona.vcApellidoPaterno + " " + item.persona.vcApellidoMaterno + " " + item.persona.vcNombres, text1: item.persona.vcNumeroDocumento };
                    }))
                },
                error: function () { console.log("ERROR..."); }
            })
        },
        minLength: 3,
        select: function (event, ui) {
            $("#nvResponsableRequerimiento137").val(ui.item.text);
            $("#iIdResponsableRequerimiento137").val(ui.item.text1);
            $("#nvResponsableRequerimiento137").prop('readonly', true);
            $("#nvResponsableRequerimiento137").css("background-color", "lightgoldenrodyellow");
        },
        error: function (ex) {
            alert('Error al traer datos.' + ex);
        }
    })

    $(function () {
        $(".datepicker").datepicker();

        $(function () {
            theTable = $("#TablaRegistrarRequerimiento137");
            $("#SrcBuscarRQ").keyup(function () {
                $.uiTableFilter(theTable, this.value);
            });
        });

    });

</script>
